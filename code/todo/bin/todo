#!/usr/bin/env ruby

require 'gli'
include GLI::App

DEFAULT_FILE='~/todo.txt'

def read_todo(line)
  line.chomp.split(/,/)
end

def write_todo(file,name,created=Time.now,completed="")
  file.puts("#{name},#{created},#{completed}")
end

def read_todos(file)
  File.open(file,'r') do |file|
    todos = Array.new
    file.readlines.each do |line|
      todos.push(read_todo(line))
    end
  end
end


switch :s
flag [:f, :filename]

command :new do |c|
  c.flag :priority
  c.switch :f

  c.action do |global_options,options,args|
    puts "Global: "
    puts "-f - #{global_options[:f]}"
    puts "Command:"
    puts "-f - #{options[:f] ? 'true' : 'false'}"
    puts "--priority - #{options[:priority]}"
    puts "args - #{args.join(',')}"
  end
end

command :list do |c|
  c.flag :s
  c.action do |global_options,options,args|
    if global_options[:f]
      todos = read_todos(global_options[:filename])
    else
      todos = read_todos(DEFAULT_FILE)
    end

    if options[:s] == 'name'
      todos = todos.sort { |a,b| a <=> b }
    end
    todos.each do |todo|
      puts todo
    end
  end
end

command :done do |c|
  c.action do |global_options,options,args|
    puts "Global:"
    puts "-f - #{global_options[:f]}"
  end
end

exit run(ARGV)


